+++
title = 'Lambda'
date = 2024-08-21T00:20:22+09:00
draft = true
+++

### íŒŒì´ì¬ ì‹¤í–‰

---
#### OS ë¬¸ì œ
Turned out to be an architecture compatibility issue -

Needed to make sure the arch matched between the lambda function, and the docker image.

Locally I was building on an M1 with arm64 but the function is configured by default to use amd64

I changed my build command to
docker buildx build --platform linux/amd64 -t <image_name>:<image_tag>

Although I could have also updated the arch type for the lambda function to use arm64

ğŸ’ ì´ ê²½ìš°, ymlì—ì„œ
ë¹Œë“œ ì´ë¯¸ì§€ OSë‘ 
serverelssê°€ ëŒë‹¤ ì‹¤í–‰í• ë•Œ OSë‘ ë‘˜ë‹¤ armìœ¼ë¡œ ë§ì¶°ì£¼ë©´ ë¨.
```yml
provider:
  ecr:
    images:
      helloimage:
        path: .
        platform: linux/arm64

  name: aws
  runtime: python3.11
  architecture: arm64
```
---
#### Docker requirements
ë„ì»¤íŒŒì¼ë¡œ íŒŒì´ì¬ requirements ì„¤ì¹˜í•˜ëŠ”ê²Œ ë² ìŠ¤íŠ¸.
InvalidEntrypoint ì—ëŸ¬ê°€ ë–´ì—ˆëŠ”ë°, aws ì»¨í…Œì´ë„ˆì—ì„œ ë„ì»¤íŒŒì¼ ì‚¬ìš©ì‹œ ê¶Œì¥ë˜ëŠ”
`ENV LAMBDA_TASK_ROOT=/var/task`ê°€ ë¹ ì ¸ìˆê¸° ë•Œë¬¸ì´ì—ˆì„ë“¯.
`COPY handler.py ${LAMBDA_TASK_ROOT}/`
ì´ë¯¸ awsì—ì„œ ë°°í¬ì‹œ pwdê°€ /var/taskë¡œ ì„¤ì •ë˜ì–´ìˆê³ ,
ì‹¤ì œ ì‹¤í–‰í•  íŒŒì¼ì´ í•´ë‹¹ í´ë”ì•ˆìœ¼ë¡œ ë“¤ì–´ê°.

ìµœì¢…ì ìœ¼ë¡œ ì•„ë˜ì™€ ê°™ì€ë°, í¬ì¸íŠ¸ëŠ”
- requirements íŒŒì¼ì„ ë³µì‚¬ í›„ installì„ í•´ì¤˜ì•¼í•œë‹¤ëŠ” ê²ƒ
   - ì–´ì°¨í”¼ . ê°€ /var/taskë¼ì„œ ì—¬ê¸°ì„œ ë°”ë¡œí•˜ë©´ ë¨
- íŒŒì´ì¬ í™˜ê²½ì—ì„œ duckdb import í›„ httpfs ìµìŠ¤í…ì…˜ ì„¤ì¹˜.

```shell
# Base image
FROM public.ecr.aws/lambda/python:3.9

# Set environment variables
ENV HOME=/home/aws
ENV LAMBDA_TASK_ROOT=/var/task

# Install pip and other dependencies
RUN pip3 install --upgrade pip \
	&& yum install gcc gcc-c++ -y

COPY requirements.txt .

RUN pip3 install -r requirements.txt

# Create a directory for additional files
RUN mkdir -p ${HOME}

# Run a Python command to set up duckdb
RUN python3 -c "import duckdb; duckdb.query('INSTALL httpfs;');"

# Copy the application code to the container
COPY handler.py ${LAMBDA_TASK_ROOT}/

# Set the CMD to the lambda handler
CMD [ "handler.hello" ]
```
---
#### requirements í”ŒëŸ¬ê·¸ì¸ (í•„ìš”ì—†ìŒ)
python requirements í”ŒëŸ¬ê·¸ì¸ì˜ ì—­í• 
- dockerizePip: true
   - pipë¡œ íŒ¨í‚¤ì§€ë¥¼ ì„¤ì¹˜í•  ë•Œ ë°˜ë“œì‹œ ë„ì»¤ë¥¼ ì“°ë¼ëŠ” ëª…ë ¹ì–´. 
- false: ë„ì»¤ íŒ¨í‚¤ì§€ ì‚¬ìš©í•˜ì§€ ì•Šì§€ë§Œ, ì˜ì¡´ì„± ë„¤ì´í‹°ë¸Œ íŒ¨í‚¤ì§€ë¥¼ ë¹Œë“œí• ê±°ë©´ ë°˜ë“œì‹œ í•„ìš”í•  ê²ƒ.


```
.project_root/
â”‚
â”œâ”€â”€ .requirements/
â”‚   â”œâ”€â”€ requests/
â”‚   â”œâ”€â”€ numpy/
â”‚   â””â”€â”€ ... (ê¸°íƒ€ ì¢…ì†ì„± íŒŒì¼ë“¤)
â”‚
â”œâ”€â”€ requests -> .requirements/requests (ì‹¬ë³¼ë¦­ ë§í¬)
â”œâ”€â”€ numpy -> .requirements/numpy (ì‹¬ë³¼ë¦­ ë§í¬)
â”‚
â”œâ”€â”€ handler.py
â””â”€â”€ serverless.yml
```
Serverless í”„ë ˆì„ì›Œí¬ëŠ” ì´ ìƒíƒœì—ì„œ í”„ë¡œì íŠ¸ë¥¼ íŒ¨í‚¤ì§•í•˜ê³  AWS Lambdaì— ë°°í¬í•©ë‹ˆë‹¤. ë°°í¬ê°€ ì™„ë£Œë˜ë©´, í”ŒëŸ¬ê·¸ì¸ì€ ìƒì„±ëœ ì‹¬ë³¼ë¦­ ë§í¬ë¥¼ ì •ë¦¬í•˜ì—¬ ë””ë ‰í† ë¦¬ë¥¼ ì²­ê²°í•˜ê²Œ ìœ ì§€í•©ë‹ˆë‹¤.

```
.project_root/
â”‚
â”œâ”€â”€ .requirements/
â”‚   â”œâ”€â”€ requests/
â”‚   â”œâ”€â”€ numpy/
â”‚   â””â”€â”€ ... (ê¸°íƒ€ ì¢…ì†ì„± íŒŒì¼ë“¤)
â”‚
â”œâ”€â”€ handler.py
â””â”€â”€ serverless.yml
```
ì‹¬ë³¼ë¦­ ë§í¬ê°€ ì œê±°ëœ í›„, .requirements/ ë””ë ‰í† ë¦¬ë§Œ ë‚¨ê³  ìµœìƒìœ„ ë””ë ‰í† ë¦¬ëŠ” ì²­ê²°í•˜ê²Œ ìœ ì§€ë©ë‹ˆë‹¤.slsss

---

ì´ ë¬¸ì œëŠ” AWS Lambda í•¨ìˆ˜ì˜ íŒ¨í‚¤ì§€ ìœ í˜•(PackageType)ì„ ë³€ê²½í•˜ë ¤ê³  í•  ë•Œ ë°œìƒí•˜ëŠ” ì˜¤ë¥˜ì…ë‹ˆë‹¤. AWS Lambda í•¨ìˆ˜ëŠ” ë‘ ê°€ì§€ íŒ¨í‚¤ì§€ ìœ í˜•ì„ ì§€ì›í•©ë‹ˆë‹¤: Zipê³¼ Image.
ì´ ì˜¤ë¥˜ ë©”ì‹œì§€ëŠ” ê¸°ì¡´ì— Zip ìœ í˜•ìœ¼ë¡œ ë°°í¬ëœ Lambda í•¨ìˆ˜ë¥¼ Image ìœ í˜•ìœ¼ë¡œ ì—…ë°ì´íŠ¸í•˜ë ¤ê³  í•  ë•Œ ë°œìƒí•©ë‹ˆë‹¤. 
AWS CloudFormation ë˜ëŠ” Serverless Frameworkì—ì„œëŠ” ì´ëŸ¬í•œ ìœ í˜• ë³€ê²½ì„ ì§ì ‘ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.

----
#### Makefile vs Dockerfile

Makefileì€ ì¼ë°˜ì ìœ¼ë¡œ C/C++ì™€ ê°™ì€ ì»´íŒŒì¼ ì–¸ì–´ì—ì„œ ë¹Œë“œ ìë™í™”ë¥¼ ìœ„í•´ ì‚¬ìš©ë˜ì§€ë§Œ, íŒŒì´ì¬ í”„ë¡œì íŠ¸ì—ì„œë„ ë¹Œë“œ, í…ŒìŠ¤íŠ¸, ë°°í¬ ë“±ì˜ ì‘ì—…ì„ ìë™í™”í•˜ëŠ” ë° ìœ ìš©í•˜ê²Œ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. Makefileì€ `make` ëª…ë ¹ì–´ì™€ í•¨ê»˜ ì‚¬ìš©ë˜ë©°, íŠ¹ì • ì‘ì—…ì„ ìë™ìœ¼ë¡œ ì‹¤í–‰í•˜ëŠ” ê·œì¹™ê³¼ ëª…ë ¹ì–´ë¥¼ ì •ì˜í•©ë‹ˆë‹¤.

íŒŒì´ì¬ í”„ë¡œì íŠ¸ì—ì„œ Makefileì„ ì‚¬ìš©í•˜ëŠ” ë°©ë²•ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤:

1. **Makefile ì‘ì„±**: í”„ë¡œì íŠ¸ ë£¨íŠ¸ ë””ë ‰í† ë¦¬ì— `Makefile`ì´ë¼ëŠ” íŒŒì¼ì„ ìƒì„±í•˜ê³ , ê·¸ ì•ˆì— í•„ìš”í•œ ì‘ì—…ì„ ì •ì˜í•©ë‹ˆë‹¤. ê° ì‘ì—…ì€ "íƒ€ê²Ÿ"ì´ë¼ëŠ” ì´ë¦„ìœ¼ë¡œ ì •ì˜ë˜ë©°, í•´ë‹¹ íƒ€ê²Ÿì´ ì‹¤í–‰ë  ë•Œ ìˆ˜í–‰í•  ëª…ë ¹ì–´ë¥¼ ì§€ì •í•©ë‹ˆë‹¤.

    ```Makefile
    # Makefile ì˜ˆì‹œ
    .PHONY: install test lint clean

    install:
        pip install -r requirements.txt

    test:
        pytest tests/

    lint:
        pylint mymodule/

    clean:
        find . -type f -name "*.pyc" -delete
        find . -type d -name "__pycache__" -delete
    ```

    ìœ„ì˜ ì˜ˆì‹œì—ì„œ `install`, `test`, `lint`, `clean`ì´ë¼ëŠ” íƒ€ê²Ÿì´ ì •ì˜ë˜ì–´ ìˆìŠµë‹ˆë‹¤.

2. **Make ëª…ë ¹ì–´ ì‹¤í–‰**: í„°ë¯¸ë„ì—ì„œ `make <íƒ€ê²Ÿ>` ëª…ë ¹ì–´ë¥¼ ì‹¤í–‰í•˜ì—¬ í•´ë‹¹ íƒ€ê²Ÿì— ì •ì˜ëœ ì‘ì—…ì„ ìˆ˜í–‰í•©ë‹ˆë‹¤.

    ```sh
    # íŒ¨í‚¤ì§€ ì„¤ì¹˜
    make install

    # í…ŒìŠ¤íŠ¸ ì‹¤í–‰
    make test

    # ì½”ë“œ ë¦°íŠ¸ ê²€ì‚¬
    make lint

    # ë¶ˆí•„ìš”í•œ íŒŒì¼ ì‚­ì œ
    make clean
    ```

Makefileì˜ ê° íƒ€ê²Ÿì€ ìë™ìœ¼ë¡œ ì‹¤í–‰ë˜ì§€ ì•Šìœ¼ë©°, ëª…ì‹œì ìœ¼ë¡œ `make <íƒ€ê²Ÿ>` ëª…ë ¹ì–´ë¥¼ ì‹¤í–‰í•´ì•¼ í•©ë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´, `make test`ë¥¼ ì‹¤í–‰í•˜ë©´ `Makefile`ì˜ `test` íƒ€ê²Ÿì— ì •ì˜ëœ `pytest tests/` ëª…ë ¹ì–´ê°€ ì‹¤í–‰ë©ë‹ˆë‹¤.

Makefileì„ ì‚¬ìš©í•˜ë©´ íŒŒì´ì¬ í”„ë¡œì íŠ¸ì—ì„œ ë°˜ë³µì ì¸ ì‘ì—…ì„ ì‰½ê²Œ ìë™í™”í•  ìˆ˜ ìˆìœ¼ë©°, íŒ€ì› ê°„ì˜ ì¼ê´€ì„±ì„ ìœ ì§€í•˜ëŠ” ë° ë„ì›€ì´ ë©ë‹ˆë‹¤.

---

#### params ë„˜ê¸°ê¸°

`serverless invoke local` ëª…ë ¹ì–´ë¥¼ ì‚¬ìš©í•˜ì—¬ JSON íŒŒì¼ì„ í†µí•´ ë°ì´í„°ë¥¼ ì „ë‹¬í•˜ëŠ” ë°©ë²•ê³¼, API í˜¸ì¶œë§ˆë‹¤ ë‹¤ë¥¸ ë°ì´í„°ë¥¼ ì „ë‹¬í•˜ëŠ” ë°©ë²•ì— ëŒ€í•´ ì„¤ëª…ë“œë¦¬ê² ìŠµë‹ˆë‹¤.

### JSON íŒŒì¼ì„ í†µí•´ ë°ì´í„° ì „ë‹¬

1. **JSON íŒŒì¼ ìƒì„±**:
   ì˜ˆë¥¼ ë“¤ì–´, `event1.json` íŒŒì¼ì„ ìƒì„±í•©ë‹ˆë‹¤.
   ```json
   {
     "queryStringParameters": {
       "name": "Alice"
     }
   }
   ```

2. **JSON íŒŒì¼ì„ ì‚¬ìš©í•˜ì—¬ í•¨ìˆ˜ í˜¸ì¶œ**:
   ```sh
   sls invoke local -f hello -p event1.json
   ```

ì´ ë°©ë²•ì„ ì‚¬ìš©í•˜ë©´ JSON íŒŒì¼ì— ì •ì˜ëœ ë°ì´í„°ê°€ Lambda í•¨ìˆ˜ì— ì „ë‹¬ë©ë‹ˆë‹¤.

### API í˜¸ì¶œë§ˆë‹¤ ë‹¤ë¥¸ ë°ì´í„°ë¥¼ ì „ë‹¬

API í˜¸ì¶œë§ˆë‹¤ ë‹¤ë¥¸ ë°ì´í„°ë¥¼ ì „ë‹¬í•´ì•¼ í•˜ëŠ” ê²½ìš°, ì—¬ëŸ¬ JSON íŒŒì¼ì„ ìƒì„±í•˜ê±°ë‚˜, `--data` ì˜µì…˜ì„ ì‚¬ìš©í•˜ì—¬ ëª…ë ¹ì–´ì—ì„œ ì§ì ‘ ë°ì´í„°ë¥¼ ì „ë‹¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

#### ì—¬ëŸ¬ JSON íŒŒì¼ ì‚¬ìš©

1. **ì—¬ëŸ¬ JSON íŒŒì¼ ìƒì„±**:
   ì˜ˆë¥¼ ë“¤ì–´, `event1.json`, `event2.json` íŒŒì¼ì„ ìƒì„±í•©ë‹ˆë‹¤.

   `event1.json`:
   ```json
   {
     "queryStringParameters": {
       "name": "Alice"
     }
   }
   ```

   `event2.json`:
   ```json
   {
     "queryStringParameters": {
       "name": "Bob"
     }
   }
   ```

2. **JSON íŒŒì¼ì„ ì‚¬ìš©í•˜ì—¬ ê°ê°ì˜ í•¨ìˆ˜ í˜¸ì¶œ**:
   ```sh
   sls invoke local -f hello -p event1.json
   sls invoke local -f hello -p event2.json
   ```

#### `--data` ì˜µì…˜ ì‚¬ìš©

ëª…ë ¹ì–´ì—ì„œ ì§ì ‘ ë°ì´í„°ë¥¼ ì „ë‹¬í•˜ë ¤ë©´ `--data` ì˜µì…˜ì„ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

1. **ëª…ë ¹ì–´ì—ì„œ ì§ì ‘ ë°ì´í„° ì „ë‹¬**:
   ```sh
   sls invoke local -f hello -d '{"queryStringParameters": {"name": "Alice"}}'
   sls invoke local -f hello -d '{"queryStringParameters": {"name": "Bob"}}'
   ```

ì´ ë°©ë²•ì„ ì‚¬ìš©í•˜ë©´ JSON íŒŒì¼ì„ ìƒì„±í•˜ì§€ ì•Šê³ ë„ ëª…ë ¹ì–´ì—ì„œ ì§ì ‘ ë°ì´í„°ë¥¼ ì „ë‹¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### ìë™í™” ìŠ¤í¬ë¦½íŠ¸ ì‚¬ìš©

API í˜¸ì¶œë§ˆë‹¤ ë‹¤ë¥¸ ë°ì´í„°ë¥¼ ì „ë‹¬í•˜ëŠ” ì‘ì—…ì„ ìë™í™”í•˜ê³  ì‹¶ë‹¤ë©´, ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì‘ì„±í•˜ì—¬ ì—¬ëŸ¬ í˜¸ì¶œì„ ìë™ìœ¼ë¡œ ìˆ˜í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´, Bash ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì‘ì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

1. **Bash ìŠ¤í¬ë¦½íŠ¸ ì‘ì„±** (`invoke.sh`):
   ```sh
   #!/bin/bash

   # Define an array of JSON data
   events=(
     '{"queryStringParameters": {"name": "Alice"}}'
     '{"queryStringParameters": {"name": "Bob"}}'
     '{"queryStringParameters": {"name": "Charlie"}}'
   )

   # Loop through the array and invoke the function with each set of data
   for event in "${events[@]}"
   do
     echo "Invoking with event: $event"
     sls invoke local -f hello -d "$event"
   done
   ```

2. **ìŠ¤í¬ë¦½íŠ¸ ì‹¤í–‰ ê¶Œí•œ ë¶€ì—¬ ë° ì‹¤í–‰**:
   ```sh
   chmod +x invoke.sh
   ./invoke.sh
   ```

ì´ ìŠ¤í¬ë¦½íŠ¸ëŠ” ì •ì˜ëœ JSON ë°ì´í„°ë¥¼ ì‚¬ìš©í•˜ì—¬ `sls invoke local` ëª…ë ¹ì–´ë¥¼ ì—¬ëŸ¬ ë²ˆ ì‹¤í–‰í•©ë‹ˆë‹¤.

### ê²°ë¡ 

- **JSON íŒŒì¼**ì„ ì‚¬ìš©í•˜ì—¬ ë°ì´í„°ë¥¼ ì „ë‹¬í•˜ëŠ” ê²½ìš°, íŒŒì¼ì„ ì—¬ëŸ¬ ê°œ ìƒì„±í•˜ì—¬ ê°ê°ì˜ ë°ì´í„°ë¥¼ ì „ë‹¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
- **`--data` ì˜µì…˜**ì„ ì‚¬ìš©í•˜ì—¬ ëª…ë ¹ì–´ì—ì„œ ì§ì ‘ ë°ì´í„°ë¥¼ ì „ë‹¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
- **ìë™í™” ìŠ¤í¬ë¦½íŠ¸**ë¥¼ ì‘ì„±í•˜ì—¬ ì—¬ëŸ¬ í˜¸ì¶œì„ ìë™ìœ¼ë¡œ ìˆ˜í–‰í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ì´ ë°©ë²•ë“¤ì„ í†µí•´ API í˜¸ì¶œë§ˆë‹¤ ë‹¤ë¥¸ ë°ì´í„°ë¥¼ íš¨ìœ¨ì ìœ¼ë¡œ ì „ë‹¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

---
#### S3 ë²„í‚· ì•¡ì„¸ìŠ¤ì‹œ

Serverless Frameworkë¥¼ ì‚¬ìš©í•˜ì—¬ S3 ë²„í‚·ì„ ì •ì˜í•˜ê³  ë°°í¬í•  ë•Œ, `sls remove` ëª…ë ¹ì–´ë¥¼ ì‚¬ìš©í•˜ë©´ ê¸°ë³¸ì ìœ¼ë¡œ S3 ë²„í‚·ë„ ì‚­ì œë©ë‹ˆë‹¤. ì´ëŠ” Serverless Frameworkê°€ ë°°í¬ëœ ëª¨ë“  ë¦¬ì†ŒìŠ¤ë¥¼ ì œê±°í•˜ëŠ” ë™ì‘ì„ í•˜ê¸° ë•Œë¬¸ì…ë‹ˆë‹¤.

ê·¸ëŸ¬ë‚˜ ì¤‘ìš”í•œ ë°ì´í„°ë¥¼ ê°–ê³  ìˆëŠ” S3 ë²„í‚·ì´ ì‚­ì œë˜ì§€ ì•Šë„ë¡ í•˜ê¸° ìœ„í•´ì„œëŠ” ë‹¤ìŒê³¼ ê°™ì€ ë°©ë²•ì„ ì‚¬ìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

1. **Serverless Frameworkì˜ `retain` ì˜µì…˜ ì‚¬ìš©**:
   CloudFormation í…œí”Œë¦¿ì—ì„œ `DeletionPolicy`ë¥¼ `Retain`ìœ¼ë¡œ ì„¤ì •í•˜ì—¬ S3 ë²„í‚·ì´ ì‚­ì œë˜ì§€ ì•Šë„ë¡ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

2. **ìˆ˜ë™ìœ¼ë¡œ S3 ë²„í‚·ì„ ìƒì„±**:
   Serverless Frameworkë¥¼ ì‚¬ìš©í•˜ì§€ ì•Šê³ , ë¯¸ë¦¬ ìˆ˜ë™ìœ¼ë¡œ S3 ë²„í‚·ì„ ìƒì„±í•˜ê³ , Serverless Frameworkì—ì„œ ì´ë¥¼ ì°¸ì¡°ë§Œ í•˜ë„ë¡ ì„¤ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

### 1. `retain` ì˜µì…˜ ì‚¬ìš©

Serverless FrameworkëŠ” CloudFormationì„ ì‚¬ìš©í•˜ì—¬ ë¦¬ì†ŒìŠ¤ë¥¼ ê´€ë¦¬í•©ë‹ˆë‹¤. ì´ë¥¼ í†µí•´ `DeletionPolicy`ë¥¼ ì„¤ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. `serverless.yml` íŒŒì¼ì„ ë‹¤ìŒê³¼ ê°™ì´ ìˆ˜ì •í•©ë‹ˆë‹¤:

```yaml
service: my-service

provider:
  name: aws
  runtime: python3.8

resources:
  Resources:
    MyS3Bucket:
      Type: AWS::S3::Bucket
      Properties:
        BucketName: my-unique-bucket-name
      DeletionPolicy: Retain

functions:
  myFunction:
    handler: handler.lambda_handler
    events:
      - s3:
          bucket: my-unique-bucket-name
          event: s3:ObjectCreated:*

```

`DeletionPolicy: Retain`ì„ ì¶”ê°€í•˜ë©´ `sls remove` ëª…ë ¹ì–´ë¥¼ ì‹¤í–‰í•˜ë”ë¼ë„ S3 ë²„í‚·ì€ ì‚­ì œë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.

### 2. ìˆ˜ë™ìœ¼ë¡œ S3 ë²„í‚·ì„ ìƒì„±í•˜ê³  ì°¸ì¡°

ë¯¸ë¦¬ S3 ë²„í‚·ì„ ìˆ˜ë™ìœ¼ë¡œ ìƒì„±í•˜ê³ , `serverless.yml` íŒŒì¼ì—ì„œ ì´ ë²„í‚·ì„ ì°¸ì¡°í•˜ë„ë¡ ì„¤ì •í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

```yaml
service: my-service

provider:
  name: aws
  runtime: python3.8

functions:
  myFunction:
    handler: handler.lambda_handler
    events:
      - s3:
          bucket: my-existing-bucket-name
          event: s3:ObjectCreated:*
```

ì´ ê²½ìš°, `sls remove` ëª…ë ¹ì–´ë¥¼ ì‹¤í–‰í•˜ë”ë¼ë„ Serverless FrameworkëŠ” í•´ë‹¹ ë²„í‚·ì„ ì‚­ì œí•˜ë ¤ê³  í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.

ì´ ë‘ ê°€ì§€ ë°©ë²•ì„ í†µí•´ ì¤‘ìš”í•œ ë°ì´í„°ë¥¼ ê°–ê³  ìˆëŠ” S3 ë²„í‚·ì´ ì‹¤ìˆ˜ë¡œ ì‚­ì œë˜ì§€ ì•Šë„ë¡ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. ì´ ì™¸ì—ë„, Serverless Frameworkì˜ ê¸°ëŠ¥ê³¼ CloudFormationì˜ ë‹¤ì–‘í•œ ì„¤ì •ì„ í™œìš©í•˜ì—¬ ì ì ˆí•˜ê²Œ ë¦¬ì†ŒìŠ¤ë¥¼ ê´€ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

---
### IAM role ì •ì˜

serverless.yml íŒŒì¼ì—ì„œ IAM ì—­í• ì„ ì •ì˜í•˜ëŠ” ê²ƒì€ Serverless Frameworkê°€ ë°°í¬í•˜ëŠ” Lambda í•¨ìˆ˜ë“¤ì´ íŠ¹ì • ê¶Œí•œì„ ê°€ì§€ë„ë¡ í•˜ê¸° ìœ„í•´ ì‚¬ìš©ë©ë‹ˆë‹¤. ì´ ì—­í• ì€ Lambda í•¨ìˆ˜ê°€ ì‹¤í–‰ë  ë•Œ ì‚¬ìš©ë˜ëŠ” ê¶Œí•œì„ ì •ì˜í•©ë‹ˆë‹¤

ì¦‰,
ë°°í¬í•  ë•Œ ê³„ì •ì—ì„œ í•„ìš”í•œ ê¶Œí•œ
aws root ê³„ì • -> ì „ë¶€ ì—´ë ¤ìˆì–´ì„œ ëœê²ƒ.

í•œí¸ yml ì•ˆì—ì„œ ì •ì˜ëœ iamì€ ìƒˆë¡œ iamì„ ë°œê¸‰
- iam ìƒì„±ê¶Œí•œ, s3, cloudformation, lambda ë“± ê¶Œí•œ í•„ìˆ˜.
ì‚¬ìš©ìëŠ” ëŒë‹¤í•¨ìˆ˜.

--
Serverless Frameworkê°€ AWSì— ì ‘ê·¼í•˜ê¸° ìœ„í•´ í•„ìš”í•œ ê¶Œí•œì€ ìˆ˜í–‰í•˜ë ¤ëŠ” ì‘ì—…ì— ë”°ë¼ ë‹¤ë¦…ë‹ˆë‹¤. í•˜ì§€ë§Œ ì¼ë°˜ì ìœ¼ë¡œ Serverless FrameworkëŠ” AWS ë¦¬ì†ŒìŠ¤ë¥¼ ìƒì„±í•˜ê³  ê´€ë¦¬í•˜ê¸° ìœ„í•´ IAM ì‚¬ìš©ì ë˜ëŠ” ì—­í• ì„ í†µí•´ ê¶Œí•œì„ ìœ„ì„ë°›ì•„ì•¼ í•©ë‹ˆë‹¤. 

ë‹¤ìŒì€ Serverless Frameworkê°€ ì¼ë°˜ì ìœ¼ë¡œ ìš”êµ¬í•˜ëŠ” ê¶Œí•œê³¼ ê·¸ ì´ìœ ì…ë‹ˆë‹¤.

**1. CloudFormation ê¶Œí•œ:**

* Serverless FrameworkëŠ” CloudFormationì„ ì‚¬ìš©í•˜ì—¬ Lambda í•¨ìˆ˜, API Gateway, DynamoDB í…Œì´ë¸”ê³¼ ê°™ì€ AWS ë¦¬ì†ŒìŠ¤ë¥¼ ë°°í¬í•˜ê³  ê´€ë¦¬í•©ë‹ˆë‹¤. ë”°ë¼ì„œ Serverless Frameworkë¥¼ ì‚¬ìš©í•˜ëŠ” IAM ì‚¬ìš©ì ë˜ëŠ” ì—­í• ì€ ë‹¤ìŒê³¼ ê°™ì€ CloudFormation ì‘ì—…ì„ ìˆ˜í–‰í•  ìˆ˜ ìˆëŠ” ê¶Œí•œì´ í•„ìš”í•©ë‹ˆë‹¤.
    * `cloudformation:CreateStack`
    * `cloudformation:DescribeStacks`
    * `cloudformation:UpdateStack`
    * `cloudformation:DeleteStack`
    * `cloudformation:DescribeStackEvents`
    * `cloudformation:GetTemplate`

**2. ì„œë¹„ìŠ¤ë³„ ê¶Œí•œ:**

* Serverless FrameworkëŠ” Lambda í•¨ìˆ˜, API Gateway, DynamoDB í…Œì´ë¸” ë“± ë‹¤ì–‘í•œ AWS ì„œë¹„ìŠ¤ë¥¼ ì‚¬ìš©í•˜ì—¬ ì• í”Œë¦¬ì¼€ì´ì…˜ì„ ë°°í¬í•©ë‹ˆë‹¤. ë”°ë¼ì„œ ì‚¬ìš©í•˜ëŠ” ì„œë¹„ìŠ¤ì— ë”°ë¼ í•´ë‹¹ ì„œë¹„ìŠ¤ì— ëŒ€í•œ íŠ¹ì • ê¶Œí•œì´ í•„ìš”í•©ë‹ˆë‹¤. ì˜ˆë¥¼ ë“¤ì–´, Lambda í•¨ìˆ˜ë¥¼ ìƒì„±í•˜ê³  ê´€ë¦¬í•˜ë ¤ë©´ ë‹¤ìŒê³¼ ê°™ì€ ê¶Œí•œì´ í•„ìš”í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
    * `lambda:CreateFunction`
    * `lambda:GetFunction`
    * `lambda:UpdateFunctionConfiguration`
    * `lambda:UpdateFunctionCode`
    * `lambda:DeleteFunction`
    * `lambda:InvokeFunction`
    * `iam:CreateRole` 
    * `iam:PutRolePolicy`
    * `iam:PassRole`

**3. S3 ë²„í‚· ì ‘ê·¼ ê¶Œí•œ:**

* Serverless FrameworkëŠ” ë°°í¬ íŒ¨í‚¤ì§€ë¥¼ ì €ì¥í•˜ê³  CloudFormation í…œí”Œë¦¿ì„ ì—…ë¡œë“œí•˜ê¸° ìœ„í•´ S3 ë²„í‚·ì„ ì‚¬ìš©í•©ë‹ˆë‹¤. ë”°ë¼ì„œ Serverless Frameworkë¥¼ ì‚¬ìš©í•˜ëŠ” IAM ì‚¬ìš©ì ë˜ëŠ” ì—­í• ì€ ë‹¤ìŒê³¼ ê°™ì€ S3 ì‘ì—…ì„ ìˆ˜í–‰í•  ìˆ˜ ìˆëŠ” ê¶Œí•œì´ í•„ìš”í•©ë‹ˆë‹¤.
    * `s3:CreateBucket` 
    * `s3:PutObject`
    * `s3:GetObject`
    * `s3:DeleteObject`
    * `s3:ListBucket`

**ìµœì†Œ ê¶Œí•œ:**

* ë³´ì•ˆì„ ìœ„í•´ Serverless Frameworkì— í•„ìš”í•œ ìµœì†Œí•œì˜ ê¶Œí•œë§Œ ë¶€ì—¬í•˜ëŠ” ê²ƒì´ ì¢‹ìŠµë‹ˆë‹¤. Serverless Frameworkê°€ ì‹¤ì œë¡œ ì‚¬ìš©í•˜ëŠ” ê¶Œí•œì€ `serverless.yml` íŒŒì¼ì— ì •ì˜ëœ ì„¤ì •ê³¼ ì‚¬ìš©í•˜ëŠ” í”ŒëŸ¬ê·¸ì¸ì— ë”°ë¼ ë‹¬ë¼ì§ˆ ìˆ˜ ìˆìŠµë‹ˆë‹¤. 

**ê¶Œí•œ ë¶€ì—¬ ë°©ë²•:**

* Serverless Frameworkì— í•„ìš”í•œ ê¶Œí•œì€ IAM ì •ì±…ì„ í†µí•´ ë¶€ì—¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. IAM ì •ì±…ì„ ìƒì„±í•˜ê³  Serverless Frameworkë¥¼ ì‚¬ìš©í•˜ëŠ” IAM ì‚¬ìš©ì ë˜ëŠ” ì—­í• ì— ì—°ê²°í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤. AWS ì½˜ì†”, AWS CLI ë˜ëŠ” SDKë¥¼ ì‚¬ìš©í•˜ì—¬ IAM ì •ì±…ì„ ê´€ë¦¬í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

**ì£¼ì˜ ì‚¬í•­:**

* ìœ„ì— ë‚˜ì—´ëœ ê¶Œí•œì€ ì¼ë°˜ì ì¸ ì˜ˆì‹œì´ë©° ì‹¤ì œ í•„ìš”í•œ ê¶Œí•œì€ í”„ë¡œì íŠ¸ì— ë”°ë¼ ë‹¤ë¥¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
* Serverless Framework ê³µì‹ ë¬¸ì„œ ë° ì‚¬ìš©í•˜ëŠ” í”ŒëŸ¬ê·¸ì¸ì˜ ë¬¸ì„œë¥¼ ì°¸ì¡°í•˜ì—¬ í•„ìš”í•œ ê¶Œí•œì„ í™•ì¸í•˜ëŠ” ê²ƒì´ ì¢‹ìŠµë‹ˆë‹¤.

Serverless Frameworkë¥¼ ì‚¬ìš©í•˜ì—¬ AWS ë¦¬ì†ŒìŠ¤ë¥¼ ì•ˆì „í•˜ê²Œ ê´€ë¦¬í•˜ë ¤ë©´ í•„ìš”í•œ ìµœì†Œí•œì˜ ê¶Œí•œì„ ë¶€ì—¬í•˜ê³  ì •ê¸°ì ìœ¼ë¡œ IAM ì •ì±…ì„ ê²€í† í•˜ì—¬ ë¶ˆí•„ìš”í•œ ê¶Œí•œì„ ì œê±°í•˜ëŠ” ê²ƒì´ ì¤‘ìš”í•©ë‹ˆë‹¤.


---
### ë¡œê·¸
AWS Lambda í•¨ìˆ˜ì˜ ë¡œê·¸ë¥¼ ë³´ëŠ” ë°©ë²•ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤:

1. AWS CloudWatch ì½˜ì†” ì‚¬ìš©:

   - AWS ì½˜ì†”ì— ë¡œê·¸ì¸í•˜ê³  CloudWatch ì„œë¹„ìŠ¤ë¡œ ì´ë™í•©ë‹ˆë‹¤.
   - ì™¼ìª½ ë©”ë‰´ì—ì„œ "ë¡œê·¸ ê·¸ë£¹"ì„ ì„ íƒí•©ë‹ˆë‹¤.
   - "/aws/lambda/[í•¨ìˆ˜ì´ë¦„]" í˜•ì‹ì˜ ë¡œê·¸ ê·¸ë£¹ì„ ì°¾ì•„ í´ë¦­í•©ë‹ˆë‹¤.
   - ë¡œê·¸ ìŠ¤íŠ¸ë¦¼ ëª©ë¡ì—ì„œ ìµœì‹  ìŠ¤íŠ¸ë¦¼ì„ ì„ íƒí•˜ì—¬ ë¡œê·¸ë¥¼ í™•ì¸í•©ë‹ˆë‹¤.

2. AWS CLI ì‚¬ìš©:

   ```
   aws logs get-log-events --log-group-name "/aws/lambda/[í•¨ìˆ˜ì´ë¦„]" --log-stream-name "[ë¡œê·¸ìŠ¤íŠ¸ë¦¼ì´ë¦„]"
   ```

3. Lambda ì½˜ì†”ì—ì„œ ì§ì ‘ í™•ì¸:

   - Lambda ì½˜ì†”ì—ì„œ í•´ë‹¹ í•¨ìˆ˜ë¥¼ ì„ íƒí•©ë‹ˆë‹¤.
   - "ëª¨ë‹ˆí„°ë§" íƒ­ìœ¼ë¡œ ì´ë™í•©ë‹ˆë‹¤.
   - "ë¡œê·¸" ì„¹ì…˜ì—ì„œ ìµœê·¼ ë¡œê·¸ë¥¼ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

4. ì½”ë“œì—ì„œ ë¡œê¹…:

   - `console.log()` ë“±ì˜ ë©”ì„œë“œë¥¼ ì‚¬ìš©í•˜ì—¬ ì½”ë“œ ë‚´ì—ì„œ ë¡œê·¸ë¥¼ ìƒì„±í•©ë‹ˆë‹¤.
   - ì´ ë¡œê·¸ë“¤ì€ ìë™ìœ¼ë¡œ CloudWatchì— ì „ì†¡ë©ë‹ˆë‹¤.

5. êµ¬ì¡°í™”ëœ ë¡œê¹… ì‚¬ìš©:

   - JSON í˜•ì‹ì˜ êµ¬ì¡°í™”ëœ ë¡œê·¸ë¥¼ ì‚¬ìš©í•˜ë©´ ë¶„ì„ì´ ë” ì‰¬ì›Œì§‘ë‹ˆë‹¤.
   - Lambda ì½˜ì†”ì˜ "êµ¬ì„±" íƒ­ì—ì„œ JSON ë¡œê·¸ í˜•ì‹ì„ í™œì„±í™”í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

6. ì™¸ë¶€ ë¡œê¹… ë„êµ¬ ì‚¬ìš©:

   - Better Stack ê°™ì€ ì™¸ë¶€ ë¡œê¹… ì„œë¹„ìŠ¤ë¥¼ ì‚¬ìš©í•˜ì—¬ ë” ê°•ë ¥í•œ ë¶„ì„ê³¼ ì•Œë¦¼ ê¸°ëŠ¥ì„ í™œìš©í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ë¡œê·¸ë¥¼ íš¨ê³¼ì ìœ¼ë¡œ í™œìš©í•˜ë ¤ë©´ ì ì ˆí•œ ë¡œê·¸ ë ˆë²¨ ì„¤ì •, êµ¬ì¡°í™”ëœ ë¡œê¹… ì‚¬ìš©, ê·¸ë¦¬ê³  í•„ìš”í•œ ê²½ìš° ì™¸ë¶€ ë„êµ¬ë¥¼ í†µí•œ ê³ ê¸‰ ë¶„ì„ì„ ê³ ë ¤í•´ë³´ì„¸ìš”.

---
### ì„œë²„ë¦¬ìŠ¤ì—ì„œ .env ë¬¸ì œ
#### ğŸ’ ë‘ ê°€ì§€ ë°©ë²•
1. `useDotenv: true` 
- ymlë‚´ environmentì— .env í‚¤ê°’ë“¤ì„ ì •ì˜í•´ì£¼ê³ 
ì½”ë“œì—ì„œ os.getenv(ë…¸ë“œì—ì„  process.env)ë¡œ ì“¸ ìˆ˜ ìˆìŒ
ğŸŒ  load_dotenv()ë¥¼ ì“°ì§€ ì•ŠìŒ!! ymlì—ì„œ ì´ë¯¸ ì£¼ì…í•œê±°ë¼
2. `serverless-dotenv-plugin` 
- `sls plugin install -n serverless-dotenv-plugin` ë¡œ ì„¤ì¹˜
- ymlì— ì„¤ì •
```
plugins:
  - serverless-dotenv-plugin
```

ğŸ”º ê²°ë¡ ì ìœ¼ë¡œ sls deployë¥¼ í•  ë•Œ í”ŒëŸ¬ê·¸ì¸ì´ ë°˜ì˜ë˜ê³  
ëŒë‹¤í•¨ìˆ˜ë¥¼ invokeí•  ë•Œë§ˆë‹¤ ê·¸ í”ŒëŸ¬ê·¸ì¸ì´ ì‘ë™í•˜ëŠ”ë“¯.
ì¤‘ê°„ì— ymlì„ ë°”ê¾¼ê±´ ì˜í–¥ì„ ì£¼ì§€ì•ŠìŒ.

ğŸ”º ì•¡ì„¸ìŠ¤í‚¤ë¡œ ê¶Œí•œì„ ì¤„ê±°ë©´ ymlì˜ IAMì„ ì •ì˜í•˜ì§€ ì•Šì•„ë„ ë˜ëŠ”ë“¯. ì´ì¤‘ìœ¼ë¡œ ã„´ã„´.
- serverless deployëŠ” ì²¨ì— aws configë¡œ í‚¤ë¥¼ ì…ë ¥í•œ IAM role(ë£¨íŠ¸ê³„ì •ì˜ Admin ë“±)ë¡œ ì‹¤í–‰ë˜ëŠ”ê±°ê³ 
- serverless invokeëŠ” yml ë˜ëŠ” .envì— ì •ì˜ëœ ì•¡ì„¸ìŠ¤í‚¤ ê¸°ë°˜ìœ¼ë¡œ ê¶Œí•œì„ ê°–ê³  AWSë¦¬ì†ŒìŠ¤ì— ì ‘ê·¼í•˜ëŠ” ê²ƒì„.

#### ì›ì¸?
Serverless Frameworkì™€ `.env` íŒŒì¼, ê·¸ë¦¬ê³  `dotenv` íŒ¨í‚¤ì§€ ì‚¬ìš©ì— ê´€í•œ ì´ ìƒí™©ì€ ëª‡ ê°€ì§€ ì¤‘ìš”í•œ ì´ìœ ì™€ ì„¤ê³„ ê²°ì •ì— ê¸°ì¸í•©ë‹ˆë‹¤:

1. ì‹¤í–‰ ì»¨í…ìŠ¤íŠ¸ì˜ ì°¨ì´:
   - Serverless FrameworkëŠ” ë¡œì»¬ì—ì„œ ì‹¤í–‰ë˜ëŠ” ë„êµ¬ì…ë‹ˆë‹¤.
   - Lambda í•¨ìˆ˜ëŠ” AWS í´ë¼ìš°ë“œ í™˜ê²½ì—ì„œ ì‹¤í–‰ë©ë‹ˆë‹¤.
   ì´ ë‘ í™˜ê²½ì€ ì„œë¡œ ë‹¤ë¥¸ ì‹¤í–‰ ì»¨í…ìŠ¤íŠ¸ë¥¼ ê°€ì§€ê³  ìˆì–´, ë¡œì»¬ì˜ `.env` íŒŒì¼ì´ ìë™ìœ¼ë¡œ í´ë¼ìš°ë“œ í™˜ê²½ì— ì „ë‹¬ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.

2. ë³´ì•ˆ ê³ ë ¤ì‚¬í•­:
   - `.env` íŒŒì¼ì€ ì¢…ì¢… ë¯¼ê°í•œ ì •ë³´ë¥¼ í¬í•¨í•©ë‹ˆë‹¤.
   - ì´ëŸ¬í•œ ì •ë³´ê°€ ìë™ìœ¼ë¡œ í´ë¼ìš°ë“œì— ì—…ë¡œë“œë˜ëŠ” ê²ƒì€ ë³´ì•ˆìƒ ìœ„í—˜í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

3. í´ë¼ìš°ë“œ ë„¤ì´í‹°ë¸Œ ì ‘ê·¼:
   - AWS Lambdaì™€ ê°™ì€ ì„œë¹„ìŠ¤ëŠ” ìì²´ì ì¸ í™˜ê²½ ë³€ìˆ˜ ê´€ë¦¬ ë©”ì»¤ë‹ˆì¦˜ì„ ì œê³µí•©ë‹ˆë‹¤.
   - Serverless FrameworkëŠ” ì´ëŸ¬í•œ í´ë¼ìš°ë“œ ë„¤ì´í‹°ë¸Œ ì ‘ê·¼ ë°©ì‹ì„ ë”°ë¥´ë„ë¡ ì„¤ê³„ë˜ì—ˆìŠµë‹ˆë‹¤.

4. ëª…ì‹œì  êµ¬ì„± ì„ í˜¸:
   - ì–´ë–¤ í™˜ê²½ ë³€ìˆ˜ê°€ í•¨ìˆ˜ì— ì „ë‹¬ë˜ëŠ”ì§€ ëª…í™•í•˜ê²Œ í•˜ê¸° ìœ„í•´, ì„¤ì • íŒŒì¼ì—ì„œ ì´ë¥¼ ëª…ì‹œì ìœ¼ë¡œ ì •ì˜í•˜ë„ë¡ ìœ ë„í•©ë‹ˆë‹¤.

5. `dotenv` íŒ¨í‚¤ì§€ì˜ ì—­í• :
   - `dotenv`ëŠ” ì£¼ë¡œ ê°œë°œ í™˜ê²½ì—ì„œ ì‚¬ìš©ë©ë‹ˆë‹¤.
   - í”„ë¡œë•ì…˜ í™˜ê²½(AWS Lambda)ì—ì„œëŠ” ë‹¤ë¥¸ ë°©ì‹ìœ¼ë¡œ í™˜ê²½ ë³€ìˆ˜ë¥¼ ê´€ë¦¬í•˜ëŠ” ê²ƒì´ ì¼ë°˜ì ì…ë‹ˆë‹¤.

6. ë‹¤ì–‘í•œ ë°°í¬ ì‹œë‚˜ë¦¬ì˜¤:
   - ê°œë°œ, ìŠ¤í…Œì´ì§•, í”„ë¡œë•ì…˜ ë“± ë‹¤ì–‘í•œ í™˜ê²½ì— ëŒ€í•´ ì„œë¡œ ë‹¤ë¥¸ í™˜ê²½ ë³€ìˆ˜ ì„¸íŠ¸ê°€ í•„ìš”í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
   - ë‹¨ì¼ `.env` íŒŒì¼ì— ì˜ì¡´í•˜ëŠ” ê²ƒì€ ì´ëŸ¬í•œ ë‹¤ì–‘í•œ ì‹œë‚˜ë¦¬ì˜¤ë¥¼ ê´€ë¦¬í•˜ê¸° ì–´ë µê²Œ ë§Œë“¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.

í•´ê²° ë°©ë²•:

1. Serverless Framework ì„¤ì •:
   ```yaml
   useDotenv: true
   
   provider:
     environment:
       VAR1: ${env:VAR1}
       VAR2: ${env:VAR2}
   ```

2. í•¨ìˆ˜ ì½”ë“œì—ì„œ `dotenv` ì‚¬ìš©:
   ```javascript
   if (process.env.NODE_ENV !== 'production') {
     require('dotenv').config();
   }
   ```

3. `serverless-dotenv-plugin` ì‚¬ìš©:
   ì´ í”ŒëŸ¬ê·¸ì¸ì„ ì‚¬ìš©í•˜ë©´ `.env` íŒŒì¼ì˜ ëª¨ë“  ë³€ìˆ˜ë¥¼ ìë™ìœ¼ë¡œ Lambda í•¨ìˆ˜ì— ì£¼ì…í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ì´ëŸ¬í•œ ì ‘ê·¼ ë°©ì‹ì€ ê°œë°œì˜ ìš©ì´ì„±ê³¼ í”„ë¡œë•ì…˜ í™˜ê²½ì˜ ë³´ì•ˆ ë° ìœ ì—°ì„± ì‚¬ì´ì˜ ê· í˜•ì„ ë§ì¶”ë ¤ëŠ” ë…¸ë ¥ì˜ ê²°ê³¼ì…ë‹ˆë‹¤. ê°œë°œìê°€ í™˜ê²½ ë³€ìˆ˜ë¥¼ ëª…ì‹œì ìœ¼ë¡œ ê´€ë¦¬í•˜ë„ë¡ ìœ ë„í•˜ë©´ì„œë„, í•„ìš”í•œ ê²½ìš° ìœ ì—°ì„±ì„ ì œê³µí•©ë‹ˆë‹¤.

---
### ë¡œê¹…

ì´ ë‚´ìš©ì€ AWS Lambdaì—ì„œ Python ëŸ°íƒ€ì„ì„ ì‚¬ìš©í•  ë•Œ ë¡œê¹…ì´ ì œëŒ€ë¡œ ì‘ë™í•˜ì§€ ì•ŠëŠ” ì´ìœ ì™€ ì´ë¥¼ í•´ê²°í•˜ëŠ” ë°©ë²•ì— ëŒ€í•´ ì„¤ëª…í•˜ê³  ìˆìŠµë‹ˆë‹¤. 

### ìš”ì•½

1. **ë¬¸ì œ ì„¤ëª…:**
   - AWS Lambdaì˜ Python ëŸ°íƒ€ì„ì€ ê¸°ë³¸ì ìœ¼ë¡œ ë¡œê¹… í•¸ë“¤ëŸ¬ë¥¼ ì‚¬ì „ êµ¬ì„±í•©ë‹ˆë‹¤.
   - ì„ íƒí•œ ëŸ°íƒ€ì„ ë²„ì „ì— ë”°ë¼ ë¡œê·¸ ë©”ì‹œì§€ì˜ í˜•ì‹ì„ ìˆ˜ì •í•˜ê±°ë‚˜ ë©”íƒ€ë°ì´í„°ë¥¼ ì¶”ê°€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.
   - í•˜ì§€ë§Œ **ë¡œê·¸ ë ˆë²¨(log-level)**ì€ ì‚¬ì „ êµ¬ì„±ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
   - ë”°ë¼ì„œ, ë¡œê·¸ ë©”ì‹œì§€ë¥¼ ë³´ë‚´ë”ë¼ë„ ì‹¤ì œë¡œ ì¶œë ¥ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.

2. **í•´ê²° ë°©ë²•:**
   - AWS Lambda ì»¨í…ìŠ¤íŠ¸ì—ì„œ ë¡œê¹… ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì˜¬ë°”ë¥´ê²Œ ì‚¬ìš©í•˜ë ¤ë©´ ë£¨íŠ¸ ë¡œê±°(root-logger)ì˜ ë¡œê·¸ ë ˆë²¨ì„ ì„¤ì •í•´ì•¼ í•©ë‹ˆë‹¤.

### ì½”ë“œ ì„¤ëª…

**ê¸°ë³¸ì ì¸ ì„¤ì •:**

```python
import logging
logging.getLogger().setLevel(logging.INFO)
```

ìœ„ ì½”ë“œëŠ” ë£¨íŠ¸ ë¡œê±°ì˜ ë¡œê·¸ ë ˆë²¨ì„ `INFO`ë¡œ ì„¤ì •í•©ë‹ˆë‹¤. ì´ ì„¤ì •ì„ í†µí•´ ë¡œê·¸ ë©”ì‹œì§€ê°€ ì˜¬ë°”ë¥´ê²Œ ì¶œë ¥ë˜ë„ë¡ í•©ë‹ˆë‹¤.

**ë¡œì»¬ í™˜ê²½ì—ì„œë„ ì‘ë™í•˜ë„ë¡ ì„¤ì •:**

ë¡œì»¬ Python ì¸í„°í”„ë¦¬í„°ì—ì„œë„ ë™ì¼í•œ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì‹¤í–‰í•  ìˆ˜ ìˆë„ë¡ í•˜ê¸° ìœ„í•´, í•¸ë“¤ëŸ¬ê°€ ì„¤ì •ë˜ì–´ ìˆëŠ”ì§€ í™•ì¸í•˜ê³ , ì„¤ì •ë˜ì–´ ìˆì§€ ì•Šë‹¤ë©´ ê¸°ë³¸ ì„¤ì •ì„ ì ìš©í•©ë‹ˆë‹¤.

```python
if len(logging.getLogger().handlers) > 0:
    # Lambda í™˜ê²½ì—ì„œëŠ” stderrë¡œ ë¡œê¹…í•˜ëŠ” í•¸ë“¤ëŸ¬ê°€ ì‚¬ì „ êµ¬ì„±ë˜ì–´ ìˆìŠµë‹ˆë‹¤.
    # ë§Œì•½ í•¸ë“¤ëŸ¬ê°€ ì´ë¯¸ ì„¤ì •ë˜ì–´ ìˆë‹¤ë©´, `.basicConfig`ëŠ” ì‹¤í–‰ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤.
    # ë”°ë¼ì„œ, ë¡œê·¸ ë ˆë²¨ì„ ì§ì ‘ ì„¤ì •í•©ë‹ˆë‹¤.
    logging.getLogger().setLevel(logging.INFO)
else:
    # í•¸ë“¤ëŸ¬ê°€ ì„¤ì •ë˜ì–´ ìˆì§€ ì•Šë‹¤ë©´, ê¸°ë³¸ ì„¤ì •ì„ ì ìš©í•©ë‹ˆë‹¤.
    logging.basicConfig(level=logging.INFO)
```

ì´ ì½”ë“œì˜ ì˜ë¯¸ëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤:

1. **í•¸ë“¤ëŸ¬ê°€ ì´ë¯¸ ì„¤ì •ëœ ê²½ìš°:**
   - AWS Lambda í™˜ê²½ì—ì„œëŠ” ê¸°ë³¸ì ìœ¼ë¡œ stderrë¡œ ë¡œê¹…í•˜ëŠ” í•¸ë“¤ëŸ¬ê°€ ì‚¬ì „ êµ¬ì„±ë˜ì–´ ìˆìŠµë‹ˆë‹¤.
   - ì´ ê²½ìš°, `basicConfig`ëŠ” ì‹¤í–‰ë˜ì§€ ì•Šìœ¼ë¯€ë¡œ, ë¡œê·¸ ë ˆë²¨ì„ ì§ì ‘ ì„¤ì •í•©ë‹ˆë‹¤.

2. **í•¸ë“¤ëŸ¬ê°€ ì„¤ì •ë˜ì§€ ì•Šì€ ê²½ìš°:**
   - ë¡œì»¬ í™˜ê²½ì—ì„œëŠ” í•¸ë“¤ëŸ¬ê°€ ì„¤ì •ë˜ì§€ ì•Šì„ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
   - ì´ ê²½ìš°, `basicConfig`ë¥¼ ì‚¬ìš©í•˜ì—¬ ê¸°ë³¸ stderr í•¸ë“¤ëŸ¬ë¥¼ ìƒì„±í•˜ê³  ë¡œê·¸ ë ˆë²¨ì„ ì„¤ì •í•©ë‹ˆë‹¤.

### ê²°ë¡ 

ì´ ì„¤ì •ì„ í†µí•´ Python ìŠ¤í¬ë¦½íŠ¸ê°€ AWS Lambda í™˜ê²½ê³¼ ë¡œì»¬ í™˜ê²½ ëª¨ë‘ì—ì„œ ì˜¬ë°”ë¥´ê²Œ ë¡œê·¸ ë©”ì‹œì§€ë¥¼ ì¶œë ¥í•  ìˆ˜ ìˆë„ë¡ í•©ë‹ˆë‹¤. 

ì˜ˆë¥¼ ë“¤ì–´, Lambda í•¨ìˆ˜ ë‚´ì—ì„œ ë¡œê·¸ë¥¼ ë‚¨ê¸°ê³  ì‹¶ë‹¤ë©´ ë‹¤ìŒê³¼ ê°™ì´ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤:

```python
import logging

if len(logging.getLogger().handlers) > 0:
    logging.getLogger().setLevel(logging.INFO)
else:
    logging.basicConfig(level=logging.INFO)

def lambda_handler(event, context):
    logging.info("This is an info message")
    logging.error("This is an error message")
    return "Hello, World!"
```

ì´ë ‡ê²Œ í•˜ë©´ ë¡œê·¸ ë©”ì‹œì§€ê°€ AWS Lambda í™˜ê²½ì—ì„œë„, ë¡œì»¬ í™˜ê²½ì—ì„œë„ ì˜¬ë°”ë¥´ê²Œ ì¶œë ¥ë©ë‹ˆë‹¤. ğŸ˜Š

---

ë¡œê·¸ í•¸ë“¤ëŸ¬ë€?
- ë¡œê·¸ ë©”ì‹œì§€ë¥¼ ì–´ë””ì— ì–´ë–¤ ë°©ì‹ìœ¼ë¡œ ì¶œë ¥í• ì§€ ê²°ì •í•˜ëŠ” ì—­í• ì„ í•©ë‹ˆë‹¤.
â€¢StreamHandler: ë¡œê·¸ ë©”ì‹œì§€ë¥¼ stdout (í‘œì¤€ ì¶œë ¥) ë˜ëŠ” stderr (í‘œì¤€ ì—ëŸ¬)ë¡œ ì „ì†¡í•©ë‹ˆë‹¤.â€¢FileHandler: ì§€ì •ëœ íŒŒì¼ì— ë¡œê·¸ ë©”ì‹œì§€ë¥¼ ê¸°ë¡í•©ë‹ˆë‹¤.

logging ë¼ì´ë¸ŒëŸ¬ë¦¬: ë¡œê·¸ë ˆë²¨ ì„¤ì •, í˜•ì‹ ì§€ì • ë“± ë‹¤ì–‘í•œ ê¸°ëŠ¥.
`logging.basicConfig(level=logging.INFO)`
- ë¡œê¹…ëª¨ë“ˆ ê¸°ë³¸ì„¤ì •. 

```python
if len(logging.getLogger().handlers) > 0:
    # The Lambda environment pre-configures a handler logging to stderr. If a handler is already configured,
    # `.basicConfig` does not execute. Thus we set the level directly.
    logging.getLogger().setLevel(logging.INFO)
else:
    logging.basicConfig(level=logging.INFO)
```
- ëŒë‹¤ í™˜ê²½ì€ ë¡œê¹… í•¸ë“¤ëŸ¬ë¥¼ ê¸°ë³¸ì ìœ¼ë¡œ stderrë¡œ ì„¤ì •. (getLogger()ì˜ ëŒ€ìƒì´ stder)
ì´ë¯¸ ì„¤ì •ëœ ê²½ìš° levelì„ ë‹¤ì´ë ‰íŠ¸ë¡œ ì„¤ì •
- ê·¸ë ‡ì§€ ì•Šì€ê²½ìš° logging ë¼ì´ë¸ŒëŸ¬ë¦¬ë‹¨ì—ì„œ ë ˆë²¨ ì„¤ì •. 