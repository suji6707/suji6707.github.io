+++
series = ['컴퓨터 밑바닥의 비밀']
tags = ['컴파일', 'CS']
title = '컴퓨터 밑바닥의 비밀 - 1.프로그래밍 언어부터 프로그램 실행까지'
date = 2024-02-25T00:20:22+09:00
# draft = true
+++
## 프로그래밍 언어를 발명한다면?

### 1장. 프로그래밍 언어부터 프로그램 실행까지

#### 1.1 여러분이 프로그래밍 언어를 발명한다면?
    
내가 작성한 코드를 컴퓨터가 어떻게 인식하는가?
    
- 최초의 프로그래머는 CPU와 의사소통
	- punched card로 0과 1로 구성된 명령어를 작성
- 어셈블리어의 등장
	- CPU의 명령어 모음을 기계어에 대응시켜 0과 1 바이너리 대신 add, sub, mov 등 인간이 인식할 수 있는 단어로 프로그램을 만들기 시작
 - 고수준 언어의 등장
 	- if, else, while문과 함수로 반복되는 명령어를 처리하고, 파라미터를 넣어 차이점을 줄 수 있게 됨
- 컴파일러
	- 인간이 작성한 문자열 코드를 트리 형태의 재귀 구문으로 변환함으로써 컴퓨터가 인식할 수 있게 함.
    - 리프 노드를 기계어로 번역하기만 하면 그 결과를 부모 노드에 적용할 수 있고, 루트까지 거슬러 올라가면 전체 트리를 구체적인 기계 명령어로 번역할 수 있음
- 해석형 언어의 탄생
	- 특정 CPU에 구애받지 않고 가상머신 또는 인터프리터를 통해 다양한 환경에서 코드를 실행할 수 있게 됨. 
    - JVM과 같은 가상머신은 자체적인 표준 명령어 집합(byte code)를 사용. 자바를 중간 코드(IR)로 컴파일한 다음 이를 실행 플랫폼의 기계어로 변환하여 실행. 
	- 파이썬과 같은 해석형 언어는 컴파일 없이 각 CPU 플랫폼에 맞는 인터프리터가 있어서 한줄 한줄 읽을 때마다 그에 맞는 기계어 변환이 런타임에 이뤄짐. 마치 각 OS 아키텍처별로 거대한 딕셔너리가 있는 것처럼..

예를 들어 
- C 코드 - 기계어 - CPU
- 자바 코드 - byte code - 기계어 - CPU
- 파이썬 코드 - 인터프리트(해석) - 기계어 - CPU

컴파일 언어와 해석형 언어의 성능차이는 큰 그림에서 최적화를 이루는 것과 한줄 한줄 실행하는 것에서 나오는 듯. 근데 스크립트 언어라해도 실제 애플리케이션에서는 그보다는 최적화가 잘 됨. JIT for Javascript가 있고, 크롬 V8은 3개의 JIT 레이어가 있다고 함. 파이썬도 C++ 바인딩 라이브러리 차원에서 컴파일로 성능 최적화 잘 되어있음
    
---
#### 1.2 컴파일러는 어떻게 작동하는가?
1. 구문 트리(syntax tree) 생성
컴파일러는 번역기인데, 일종의 텍스트 처리 프로그램(text processor)라고도 볼 수 있음. 
기본적으로 텍스트로 된 소스코드를 토큰으로 잘게 쪼게고 {} 괄호 등을 파싱하는 작업을 통해 구문 트리를 만듦. (중괄호 안에 중괄호.. 이게 일종의 재귀 구문)

2. 의미 분석(semantic analysis)
구문 트리가 생성되고 나면 연산하려는 값들의 타입 등을 체크해서 이상이 없는지 확인. 

3. 중간 코드(Intermediate Representation Code, IR Code) 생성

4. 어셈블리어 코드로 변환
5. 기계어로 변환 - CPU가 실행

