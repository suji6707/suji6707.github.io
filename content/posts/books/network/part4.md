+++
title = '스터디 4회차'
date = 2024-05-07T00:20:22+09:00
draft = true
+++
## 네트워크 이중화 기술 - 네트워크 디자인, 보안

---
## 네트워크 이중화 기술 (427)
LACP: Link Aggregation Control Protocol
- 장비끼리 연결할 때 호환성 문제 위해 상호호환 가능한 연결계층 표준화 시작.
- 대역폭 확장을 통한 링크 사용률 향상, 장애 회복 개선.


## 네트워크 디자인 (525)
2계층 네트워크는 스패닝트리 프로토콜(STP)로 루프문제 해결


## 네트워크 보안 (351)

보안그룹은 인스턴스 기준이고
NACL은 서브넷 기준으로 적용함

* 여러 레이어
라우팅테이블에서 트래픽 관리
NACL로 필터링
보안그룹으로 한번더 보안.

로드밸런서를 통해 두 개의 인스턴스를 연결,
ALB에 WAF방화벽 연결해서 웹 서비스에 대한 공격을 조사할 수 있음.

---
방화벽은 포트를 차단?
방화벽과 보안그룹, NACL의 차이?
- 보안그룹과 NACL은 어디에서 보안을 해주는가의 차이

#### 방화벽은 stateful 하다
- 세션 기반 방화벽의 상태 추적 기능
- 외부에서 들어오는 트래픽은 내부망 말고 다른 IP를 허용하지 않았음에도
세션테이블에 기록되므로 허용됨.  
-> 항상 방화벽을 거쳐서 오는거고.
소켓통신은 항상 열어두는건가?

나가는 트래픽은 방화벽이 필요한가?

보안그룹 허용 ->리눅스 방화벽 허용

DDoS는 7계층 공격이라
방화벽 3,4계층으로는 다 막을 수 없음.

DDoS 공격이 분산되면 어떻게 알지? 비정상인지?
- 어려움. 

패턴과 다른 트래픽이 들어오면 차단하는 정책 세울 수 있음.
- 장비 설치하면 한달동안 임계치를 설정하고.

대부분 PC에서 붙는거면 SSL VPN임.

---
데이터센터:
원래 north-south 통신이었는데 (내부-외부 들어오고 나가는)
빅데이터시대가 되면서 
데이터센터 내부 east-west 통신이 굉장히 많아졌음...

상용망, staging, develop 망 간의 분리가 있는데
- 망 내부에선 보안 거의 없음. 망 간에는 막지만.

---
### Q&A
패킷에서 까야하는게 많으면 부하가 많아지면서 성능이 떨어지는데.
가격도 비쌈.

방화벽은 기본적으로 4계층,
IPS는 7계층을 다 까봐야함.
4계층까지는 정상인데 7계층에서 비정상적으로 들어오는 요청 보려고.
-> 성능이 떨어지거나 비쌈.

IPS에 앞단에 두려면 너무 비쌀꺼라
방화벽 다음에 IPS.

DDoS 장비는 더 앞단에.
계속 sin만 보내는.
다시 응답이 와야지 세션이 맺어지는데.

회사에선 못막고(수십테라가 한번에..), 
ISP에서 제공하는 서비스들이 우리회사 앞단에서 막아주는 것.
글로벌리 공격이면 출발지 인근에서 막도록..

#### 방화벽 vs NACL
일반적인 방화벽은 NACL과 유사함.
NACL은 초기 방화벽처럼 세션테이블이 없어서 인바운드/아웃바운드 다 써야 함.
그래서 현업에서 잘 안씀. 
들어올때 80이 와도 나갈때 너무많이 열어야해서.
대부분 security group만 관리함.

보안그룹은 deny를 걸 수 없고 열면 허용임.
근데 NACL은 permit, deny 같이 걸 수 있음.
특정을 막거나 허용할 때 순서 넣기.

방화벽은 정책이 1부터 topdown으로 하나하나 비교.
내 정책이 맨 아래쪽에있으면 너무 오래걸림

NACL은 중간에 permit, deny 넣고 유연하게 걸 수 있음.


---

네트워크 방화벽이 보안그룹과 비슷
애플리케이션까지 인지.
세션맺는 포트랑 데이터맺는 포트가 달라서.

리눅스 방화벽은 NAT도 할수있고 기능이 더 많음.
막는기능은 유사하지만. 
iptables- 
근데 복잡해서 안쓰는경우 많음.

---

ELB는 80포트를 열어놔서 외부 any 받는데.
🔮 ELB 보안그룹은 'ELB를 거치지 않은 요청'은 비정상이다- 판단.
chaining 방식. 앞단부터 기록 보면서 - 

