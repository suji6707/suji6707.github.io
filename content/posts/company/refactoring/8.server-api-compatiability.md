+++
title = 'ì„œë²„ API í˜¸í™˜ì„±'
date = 2024-05-07T00:20:22+09:00
draft = true
+++
## ê¸°ì¡´ ì„œë²„ API í˜¸í™˜ì„±

#### ğŸ‹ ì…‹íŒ… ê´€ë ¨ ëª°ì•„ì„œ ì§ˆë¬¸í•˜ê¸°
- @UsePipes(new ValidationPipe({ transform: true }))
  - ì™œ ë¶™ì—¬ì•¼í•¨? ì–´ë–¤ê²½ìš°ì—?
- 

#### íŒŒì‹±
- cheerio
  - ViaHTMLë¡œ íŒŒì‹±í•˜ëŠ” ê²½ìš°.
    - scraperëŠ” htmlë§Œ stringìœ¼ë¡œ ì£¼ê³ 
    - íŒŒì„œì—ì„œ ê·¸ htmlë¥¼ cheerio ë¡œë“œí•œ í›„ íŒŒì‹±í•œë‹¤
    - ğŸŸ£ cheerioë¥¼ íŒŒì„œì—ì„œ ì±…ì„ì§€ëŠ” ê±¸ë¡œ í•©ì‹œë‹¤!
      - ì›ë˜ëŠ” ìŠ¤í¬ë˜í¼ ì—­í• ì¸ requestPageì—ì„œ $: cheerio.loadë¡œ ë³€í™˜ í›„ ì „ë‹¬í–ˆì—ˆìŒ. 
      - ì´ë ‡ê²Œ í•´ë„ë˜ëŠ”ë° ì´ë¯¸ scrapHelper.retrieve í•¨ìˆ˜ì—ì„œ ê·¸ëƒ¥ dataë§Œ ì „ë‹¬í•˜ë„ë¡ í•´ë‘”ì§€ë¼.. (ì—¬ê¸°ì— ì¸í„°ì…‰í„°ë¥¼ ë‘ê³  html bodyì™€ í•¨ê»˜ $ cheerio loadë¥¼ ê°™ì´ ì£¼ë„ë¡ í•´ë„ë˜ê¸´ í•¨ ê·€ì°®ì„ë“¯)
```typescript
getProductDailyInfoViaHTML(html: string) {
    let body = null;
    const $ = cheerio.load(html);
```

---
#### /usage, /addable ë¨¼ì €
- ë‘˜ ë‹¤ ë³„ë„ ìœ ìŠ¤ì¼€ì´ìŠ¤ ì—†ì´ trackingPolicyService ë¡œ ë°”ë¡œ ë„˜ê¸°ê² ìŒ.
- ë ˆê±°ì‹œ ì„œë²„ ì—°ë™
  - ë‚˜ì¤‘ì— route ìƒˆë¡œ íŒŒê³  session checker ë¯¸ë“¤ì›¨ì–´ ë„£ê¸°.
    v4 ê°™ì´ ì–´ë””ì— ì •ì˜í• ì§€ ê²°ì •.
  - ë ˆê±°ì‹œì— ë§ˆì € ì¶”ê°€í•˜ê¸°
    - keyword/addable


#### example
authLegacyGuard ë¹¼ê³  í•˜ê¸°.



#### /check
ğŸ’ check í›„ user tracking ìë™ìœ¼ë¡œ ì €ì¥í•˜ì§€ë§Œ
ì›ë˜ ìˆë˜ APIëŠ” í˜¸í™˜ì„± ìœ„í•´ ë§Œë“¤ì–´ë‘ê¸° trueë§Œ ë¦¬í„´í• ì§€ì–¸ì •


#### ê¸°íƒ€ ì—°ë™ ê´€ë ¨
router.get('/addable', async (req, res, next) => {
- ê¼­ next ë„£ì–´ì•¼ í•˜ë‚˜?

ì¿ í‚¤: ì¿ í‚¤ ë§Œë£Œì•¼ ê·¸ë ‡ë‹¤ ì³ë„ ë‹¤ë¥¸ ìœ ì €ë¡œ ë¡œê·¸ì¸í•˜ë©´ ì¿ í‚¤ë¥¼ ë§Œë£Œì‹œì¼œë²„ë¦¬ëŠ”ê±´ê°€?



#### ì—ëŸ¬ì²˜ë¦¬
throw new Error -> ëŠ” ê·¸ëƒ¥ UNKOWN ì—ëŸ¬ë¡œ í´ë¼ì— ì „ë‹¬ë¼ë²„ë¦¼.
ğŸŸ£ HttpException ìœ¼ë¡œ í•´ì¤˜ì•¼ Exception filterë‹¨ì—ì„œ ì¡í˜€ì„œ setErrorë¡œ ì˜ ë‚˜ê°€ë‚˜ë´„.

ì•„ë‹ˆë©´ ì—ëŸ¬ ì²˜ë¦¬í•  ë•Œ 
ì—ëŸ¬í•¸ë“¤ëŸ¬ì—ì„œ ì—ëŸ¬ íƒ€ì…ìœ¼ë¡œ í•¸ë“¤ë§í•´ë„ ë¨.


#### ì™¸ë¶€ API ì—ëŸ¬ì²˜ë¦¬
ë‘ ê°€ì§€ ë™ì‘ì´ ìˆìŒ.
1. ë¡œê·¸ë¥¼ ì°ëŠ”ê²ƒ : data.error_msg
2. í´ë¼ì´ì–¸íŠ¸ì— ì‘ë‹µì„ í•˜ëŠ” ê²ƒ : data.status code, ì „ì²´ data
- dataì—ëŠ” ì—ëŸ¬ë©”ì‹œì§€, ìƒíƒœì½”ë“œ ë“±ì´ ëª¨ë‘ í¬í•¨ë˜ì–´ìˆê³  ì½œìŠ¤íƒë„.

```javascript
res.setError = function (_err, isApiError = false) {
    if (isApiError) {
        logger.error(_err?.response?.data?.error_msg ?? _err);
        _err?.response?.data 
        ? res.status(_err.response.data.result_code).send(_err.response.data) 
        : res.setError(_err);
    }
```


