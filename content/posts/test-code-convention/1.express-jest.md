+++
title = 'Expressì—ì„œ Test ì„¤ì •'
date = 2024-09-21T00:20:22+09:00
draft = true
+++
## Jest

### Retry
retry ê²½ìš° ê°™ì€ í•¨ìˆ˜ì— ëŒ€í•´ ì—¬ëŸ¬ë²ˆ ì‹¤í–‰ -> ê° í˜¸ì¶œë§ˆë‹¤ ë‹¤ë¥¸ ê°’ì„ ë°˜í™˜í•˜ë„ë¡ ì„¤ì • ê°€ëŠ¥

```js
myMock
  .mockReturnValueOnce(10)
  .mockReturnValueOnce('x')
  .mockReturnValue(true);

expect(mock).toHaveBeenNthCalledWith(1, '1st call args');
expect(mock).toHaveBeenNthCalledWith(2, '2nd call arg 1', '2nd call arg 2');
```

----
## Partial mocking
ðŸ’Ž ë­ê°€ëë“  afterEachì—ì„œ clearAllMocks í•´ì¤˜ì•¼í•¨. ì•ˆê·¸ëŸ¬ë©´ mock í˜¸ì¶œì´ ëˆ„ì ë¨.

Jestì˜ mock í•¨ìˆ˜ì—ì„œ clear(), reset(), restore() ë©”ì„œë“œì˜ ì£¼ìš” ì°¨ì´ì ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤:

1. mockClear():
   - ëª¨ë“  í˜¸ì¶œ ì •ë³´(mock.calls, mock.instances ë“±)ë¥¼ ì´ˆê¸°í™”í•©ë‹ˆë‹¤.
   - êµ¬í˜„ëœ mock í•¨ìˆ˜ëŠ” ê·¸ëŒ€ë¡œ ìœ ì§€ë©ë‹ˆë‹¤.
   - ì£¼ë¡œ ê° í…ŒìŠ¤íŠ¸ ì‚¬ì´ì— í˜¸ì¶œ ì •ë³´ë¥¼ ì´ˆê¸°í™”í•  ë•Œ ì‚¬ìš©í•©ë‹ˆë‹¤.

2. mockReset():
   - mockClear()ì˜ ëª¨ë“  ê¸°ëŠ¥ì„ í¬í•¨í•©ë‹ˆë‹¤.
   - ì¶”ê°€ë¡œ ëª¨ë“  mock êµ¬í˜„, ë°˜í™˜ê°’, í”„ë¡œë¯¸ìŠ¤ ê²°ê³¼ ë“±ì„ ì œê±°í•©ë‹ˆë‹¤.
   - mock í•¨ìˆ˜ë¥¼ ì´ˆê¸° ìƒíƒœë¡œ ë˜ëŒë¦½ë‹ˆë‹¤.

3. mockRestore():
   - mockReset()ì˜ ëª¨ë“  ê¸°ëŠ¥ì„ í¬í•¨í•©ë‹ˆë‹¤.
   - ì¶”ê°€ë¡œ jest.spyOn()ìœ¼ë¡œ ìƒì„±ëœ mockì„ ì›ëž˜ì˜ (non-mocked) êµ¬í˜„ìœ¼ë¡œ ë³µì›í•©ë‹ˆë‹¤.
   - ì˜¤ì§ jest.spyOn()ìœ¼ë¡œ ìƒì„±ëœ mockì—ì„œë§Œ ì‚¬ìš© ê°€ëŠ¥í•©ë‹ˆë‹¤.

ì˜ˆì‹œ ì½”ë“œì—ì„œ:
- mockClear() í›„: í˜¸ì¶œ íšŸìˆ˜ëŠ” ì´ˆê¸°í™”ë˜ì§€ë§Œ, mock êµ¬í˜„ì€ ì—¬ì „ížˆ ìœ ì§€ë©ë‹ˆë‹¤.
- mockReset() í›„: mock êµ¬í˜„ì´ ì œê±°ë˜ì–´ undefinedë¥¼ ë°˜í™˜í•©ë‹ˆë‹¤.
- mockRestore() í›„: ì›ëž˜ì˜ utils.whoAreYou í•¨ìˆ˜ê°€ ë³µì›ë©ë‹ˆë‹¤.

spy.mockRestore()ì‹œ ì›ëž˜ í•¨ìˆ˜ë¡œ ë³µì›ë˜ë‚˜ í•œë²ˆì˜ í˜¸ì¶œ ì•ˆì—ì„œ ì™”ë‹¤ê°”ë‹¤ í•  ìˆ˜ëŠ” ì—†ìŒ
ì•„ëž˜ ë°©ë²•ìœ¼ë¡œ retry ì•ˆì—ì„œ ë³µì› ì‹œë„.

```js
test('ë²ˆì—­ ê²°ê³¼ê°€ í•œê¸€ì„ í¬í•¨í•˜ë©´ ìž¬ì‹œë„ 2) ì‹¤ì œ í•¨ìˆ˜ í˜¸ì¶œ', async () => {
	const originalText = 'ì–‘ê°ˆë¹„';
	const translatedText = 'ç¾Šê°ˆë¹„';
	const validText = 'ç¾ŠæŽ’';

	const originalExecute = googleAIService.executePrompt;
	const spy = jest.spyOn(googleAIService, 'executePrompt')

	spy.mockImplementationOnce(() => Promise.resolve(translatedText))
		.mockImplementation(originalExecute);

	const result = await googleAIService.translate(originalText);

	expect(result).toBe(validText);
	expect(googleAIService.executePrompt).toHaveBeenCalledTimes(2);
})
```